# Helper functions and aliases

# Download shortcut
alias dload="curl --remote-name --progress-bar --location"

# Rerun with sudo
alias please='sudo $(fc -ln -1)'

# Modern tool aliases (ripgrep, fd-find)
if command -v fdfind &> /dev/null; then
  alias fd='fdfind'
fi

alias rg="rg --hidden"

# search PATTERN in *log under /var/log: fd -e log 'PATTERN' /var/log
# find -exec grep pattern => rg -n 'TODO' -g '*.py' -g '*.sh' .

# Inline aliases for less and grep: ps awwx G ssh
alias -g G='| grep'
alias -g L='| less -FRX'
alias -g J='| jq -C'
alias -g E='2>&1 |'
alias -g C='| xclip -selection clipboard'

# List aliases (eza)
alias ll='eza -al --sort=modified'
alias la='eza -A'
alias l='eza -CF'

# Modern find alternatives (if fd not installed, fallback to find)
if ! command -v fd &> /dev/null && ! command -v fdfind &> /dev/null; then
  alias ffd='find . -type d -name'
  alias fff='find . -type f -name'
fi

# Newest file and directory glob aliases
alias -g ND='*(/om[1])'  # newest directory
alias -g NF='*(.om[1])'  # newest file

# Sort processes by CPU and memory usage
function psc() {
  ps --cols=1000 --sort='-%cpu,uid,pgid,ppid,pid' -e \
     -o user,pid,ppid,pgid,stime,stat,wchan,time,pcpu,pmem,vsz,rss,sz,args |
     sed 's/^/ /' | less
}

function psm() {
  ps --cols=1000 --sort='-vsz,uid,pgid,ppid,pid' -e \
     -o user,pid,ppid,pgid,stime,stat,wchan,time,pcpu,pmem,vsz,rss,sz,args |
     sed 's/^/ /' | less
}

# World clock - display time in multiple timezones
function worldclock() {
  local SEATTLE=$(TZ=America/Los_Angeles date +"%c (%z %Z)")
  local NEW_YORK=$(TZ=America/New_York date +"%c (%z %Z)")
  local LONDON=$(TZ=Europe/London date +"%c (%z %Z)")
  local PARIS=$(TZ=Europe/Paris date +"%c (%z %Z)")
  local TOKYO=$(TZ=Asia/Tokyo date +"%c (%z %Z)")
  local HONG_KONG=$(TZ=Asia/Hong_Kong date +"%c (%z %Z)")
  local UTC=$(TZ=UTC date +"%c (%z %Z)")

  echo "Seattle      $SEATTLE"
  echo "New York     $NEW_YORK"
  echo "London       $LONDON"
  echo "Paris        $PARIS"
  echo "Tokyo        $TOKYO"
  echo "Hong Kong    $HONG_KONG"
  echo "UTC          $UTC"
}

# Create directory and change into it
function cdd() {
  local dir=$1
  if [[ -z "$dir" ]]; then
    echo "Usage: cdd <directory>"
    return 1
  fi
  mkdir -p "$dir" && cd "$dir"
}

# AWS EC2 helper functions
function ec2byprivip() {
  local ip=$1
  if [[ -z "$ip" ]]; then
    echo "Usage: ec2byprivip <private-ip>"
    return 1
  fi

  aws ec2 describe-instances \
    --filters "Name=network-interface.addresses.private-ip-address,Values=$ip" \
    --query 'Reservations[*].Instances[*].[InstanceId,PrivateIpAddress,PublicIpAddress,InstanceType,Tags[?Key==`Name`]|[0].Value]' \
    --output table
}

function ec2all() {
  aws ec2 describe-instances \
    --query 'Reservations[*].Instances[*].[InstanceId,PrivateIpAddress,PublicIpAddress,InstanceType,State.Name,Tags[?Key==`Name`]|[0].Value]' \
    --output table
}

# Quick directory navigation
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'

# OpenCode
alias oc='opencode'
